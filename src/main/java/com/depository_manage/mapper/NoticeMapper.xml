<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- notice -->
<mapper namespace="com.depository_manage.mapper.NoticeMapper">
    <!-- This code was generated by TableGo tools, mark 1 begin. -->
    <!-- 字段映射 -->
    <resultMap id="noticeMap" type="com.depository_manage.entity.Notice">
        <id column="id" property="id" jdbcType="INTEGER" />
        <result column="title" property="title" jdbcType="VARCHAR" />
        <result column="content" property="content" jdbcType="VARCHAR" />
        <result column="time" property="time" jdbcType="TIMESTAMP" />
        <result column="at_id" property="atId" jdbcType="INTEGER" />
        <result column="mname" property="mname" jdbcType="VARCHAR" /> <!-- 如果改为productName，这里也要改 -->
        <result column="depository_id" property="depositoryId" jdbcType="INTEGER" />
        <result column="model" property="model" jdbcType="VARCHAR" />
        <result column="type_name" property="typeName" jdbcType="VARCHAR" />
        <result column="last_count" property="lastCount" jdbcType="VARCHAR" />
    </resultMap>


    <!-- 表查询字段 -->
    <sql id="allColumns">
        n.id, n.title, n.content, n.time, n.at_id , n.mname , n.depository_id , n.model, n.type_name ,n.last_count
    </sql>

    <!-- 查询所有 -->
    <select id="findNoticeAll" resultMap="noticeMap">
        SELECT
        <include refid="allColumns" />
        FROM notice n
    </select>

    <!-- 根据条件参数查询列表 -->
    <select id="findNoticeByCondition" resultMap="noticeMap" parameterType="map">
        SELECT
        <include refid="allColumns" />
        FROM notice n WHERE 1 = 1
        <if test="title != null and title != ''">
            AND n.title LIKE CONCAT('%', #{title}, '%')
        </if>
        <if test="content != null and content != ''">
            AND n.content LIKE CONCAT('%', #{content}, '%')
        </if>
        <if test="time != null">
            AND n.time = #{time}
        </if>
        <if test="atId != null">
            AND n.at_id = #{atId}
        </if>
        <if test="depositoryId != null">
            AND n.depository_id = #{depositoryId}
        </if>
        order by n.time DESC
<!--        <if test="begin != null and size != null">-->
<!--            LIMIT #{begin},#{size}-->
<!--        </if>-->
    </select>

    <!-- 根据主键查询信息 -->
    <select id="findNoticeByIds" resultMap="noticeMap" parameterType="list">
        SELECT
        <include refid="allColumns" />
        FROM notice n WHERE n.id IN
        <foreach collection="list" index="index" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </select>

    <!-- 新增信息 -->
    <insert id="addNotice">
        INSERT INTO notice (
        title, content, time, at_id, mname, depository_id, model, type_name, last_count
        ) VALUES (
        #{title},
        #{content},
        #{time},
        #{atId},
        #{mname},
        #{depositoryId},
        #{model},
        #{typeName},
        #{lastCount}
        )
    </insert>

    <!-- 批量新增信息 -->
    <insert id="addNotices" parameterType="list">
        INSERT INTO notice (
        id, title, content, time,
        <!-- 新增字段 -->
        at_id, mname, depository_id, model, type_name, last_count
        ) VALUES
        <foreach collection="list" index="index" item="item" separator=",">
            (
            #{item.id},
            #{item.title},
            #{item.content},
            #{item.time},
            <!-- 新增字段 -->
            #{item.atId},
            #{item.mname},
            #{item.depositoryId},
            #{item.model},
            #{item.typeName},
            #{item.lastCount}
            )
        </foreach>
    </insert>

    <!-- 修改信息 -->
    <update id="updateNotice">
        UPDATE notice
        <set>
            <if test="title != null">
                title = #{title},
            </if>
            <if test="content != null">
                content = #{content},
            </if>
            <if test="time != null">
                time = #{time},
            </if>
            <!-- 新增字段条件 -->
            <if test="atId != null">
                at_id = #{atId},
            </if>
            <if test="mname != null">
                mname = #{mname},
            </if>
            <if test="depositoryId != null">
                depository_id = #{depositoryId},
            </if>
            <if test="model != null">
                model = #{model},
            </if>
            <if test="typeName != null">
                type_name = #{typeName}
            </if>
            <if test="lastCount != null">
                last_count = #{lastCount}
            </if>
        </set>
        WHERE id = #{id}
    </update>

    <!-- 批量修改信息 -->
    <update id="updateNotices" parameterType="list">
        <foreach collection="list" index="index" item="item" separator=";">
            UPDATE notice
            <set>
                <if test="item.title != null">
                    title = #{item.title},
                </if>
                <if test="item.content != null">
                    content = #{item.content},
                </if>
                <if test="item.time != null">
                    time = #{item.time},
                </if>
                <!-- 新增字段条件 -->
                <if test="item.atId != null">
                    at_id = #{item.atId},
                </if>
                <if test="item.mname != null">
                    mname = #{item.mname},
                </if>
                <if test="item.depositoryId != null">
                    depository_id = #{item.depositoryId},
                </if>
                <if test="item.model != null">
                    model = #{item.model},
                </if>
                <if test="item.typeName != null">
                    type_name = #{item.typeName}
                </if>
                <if test="item.lastCount != null">
                    last_count = #{item.lastCount}
                </if>
            </set>
            WHERE id = #{item.id}
        </foreach>
    </update>

    <!-- 根据主键删除 -->
    <delete id="deleteNoticeById" parameterType="int">
        DELETE FROM notice WHERE id = #{id}
    </delete>

    <!-- 根据主键批量删除 -->
    <delete id="deleteNoticeByIds" parameterType="list">
        DELETE FROM notice WHERE id IN
        <foreach collection="list" index="index" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
    <select id="findNoticeByAtIdAndDepository" resultMap="noticeMap" parameterType="map">
        SELECT * FROM notice
        WHERE at_id = #{atId} AND depository_id = #{depositoryId}
    </select>

</mapper>