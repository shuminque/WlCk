<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/static/lib/layui-v2.8.17/css/layui.css" media="all">
</head>
<body>
<div class="layui-container">
    <div class="layui-row">
        <div class="layui-col-md6">
            <h3>SAB 数据</h3>
            <table id="categoryTreeSAB" class="layui-table" lay-filter="categoryTreeSAB"></table>
        </div>
        <div class="layui-col-md6">
            <h3>ZAB 数据</h3>
            <table id="categoryTreeZAB" class="layui-table" lay-filter="categoryTreeZAB"></table>
        </div>
    </div>
</div>
<script src="/static/lib/layui-v2.8.17/layui.js" charset="utf-8"></script>
<script>
    layui.use(['treeTable', 'jquery'], function() {
        var $ = layui.jquery;
        var treeTable = layui.treeTable;

        function renderTreeTable(elem, url) {
            $.get(url, function(response) {
                var originalData = response.data; // 提取 data 字段
                treeTable.render({
                    elem: elem,
                    data: originalData,
                    tree: {
                        iconIndex: 2,
                        isPidData: true,
                        idName: 'id',
                        pidName: 'parentId'
                    },
                    cols: [ [
                        {field: 'title', title: '分类名称'},
                        {fixed: 'right', title: '操作', toolbar: '#barDemo'}
                    ]]
                });
            });
        }


        renderTreeTable('#categoryTreeSAB', "/api/categories/sab");
        renderTreeTable('#categoryTreeZAB', "/api/categories/zab");
        // 绑定 categoryTreeSAB 表格的工具按钮事件
        treeTable.on('tool(categoryTreeSAB)', function (obj) {
            var layEvent = obj.event;
            var data = obj.data; // 获取当前行数据
            // 这里处理 categoryTreeSAB 表格的添加、编辑和删除按钮点击事件
            handleToolEvent(layEvent, data, 'SAB');
        });

// 绑定 categoryTreeZAB 表格的工具按钮事件
        treeTable.on('tool(categoryTreeZAB)', function (obj) {
            var layEvent = obj.event;
            var data = obj.data; // 获取当前行数据
            // 这里处理 categoryTreeZAB 表格的添加、编辑和删除按钮点击事件
            handleToolEvent(layEvent, data, 'ZAB');
        });

// 处理工具按钮事件的函数
        function handleToolEvent(layEvent, data, tableType) {
            var urlPrefix = '/api/categories/' + tableType.toLowerCase();
            if (layEvent === 'add') {
                // 处理添加事件
                layer.prompt({title: '请输入新分类名称', formType: 0}, function(value, index){
                    // 调用添加 API
                    $.post(urlPrefix + '/add', { title: value, parentId: data.id }, function(response) {
                        if(response.success) {
                            layer.msg('添加成功!');
                            treeTable.reload('categoryTree' + tableType);
                        } else {
                            layer.msg('添加失败: ' + response.message);
                        }
                    });
                    layer.close(index);
                });
            } else if (layEvent === 'edit') {
                // 处理编辑事件
                layer.prompt({title: '修改分类名称', formType: 0, value: data.title}, function(value, index){
                    // 调用更新 API
                    $.ajax({
                        url: urlPrefix + '/update',
                        type: 'PUT',
                        contentType: 'application/json',
                        data: JSON.stringify({ id: data.id, title: value }),
                        success: function(response) {
                            if(response.success) {
                                layer.msg('修改成功!');
                                treeTable.reload('categoryTree' + tableType);
                            } else {
                                layer.msg('修改失败: ' + response.message);
                            }
                        }
                    });
                    layer.close(index);
                });
            } else if (layEvent === 'del') {
                // 处理删除事件
                layer.confirm('确定要删除吗?', function(index){
                    // 调用删除 API
                    $.ajax({
                        url: '/api/categories/delete/' + data.id,
                        type: 'DELETE',
                        success: function(response) {
                            if(response.success) {
                                layer.msg('删除成功!');
                                treeTable.reload('categoryTree' + tableType);
                            } else {
                                layer.msg('删除失败: ' + response.message);
                            }
                        }
                    });
                    layer.close(index);
                });
            }
        }


    });
</script>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="add">添加</a>
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

</body>
</html>
