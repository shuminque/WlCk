<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="stylesheet" href="/static/lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="/static/css/public.css" media="all">
    <title>OnceFill Records</title>
</head>
<body>

<div class="layui-container">
    <h2>添加一次性部品</h2>
    <form class="layui-form" id="onceFillForm">
        <div class="layui-form-item">
            <label class="layui-form-label">品名</label>
            <div class="layui-input-block">
                <input type="text" name="name" required lay-verify="required" placeholder="Enter Name" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">规格</label>
            <div class="layui-input-block">
                <input type="text" name="model" required lay-verify="required" placeholder="Enter model" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">单价</label>
            <div class="layui-input-block">
                <input type="text" name="unitPrice" required lay-verify="required" placeholder="Enter unit_price" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">数量</label>
            <div class="layui-input-block">
                <input type="text" name="quantity" required lay-verify="required" placeholder="Enter quantity" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">时间</label>
            <div class="layui-input-block">
                <input name="time" type="text" id="storageDate" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">备注</label>
            <div class="layui-input-block">
                <input type="text" name="applyRemark" required lay-verify="required" placeholder="Enter applyRemark" autocomplete="off" class="layui-input">
            </div>
        </div>
        <input type="hidden" name="price" id="priceInput">
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="formSubmit">添加</button>
            </div>
        </div>
    </form>
</div>
<script src="/static/lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
<script type="text/javascript" src="/static/js/http_ajax.googleapis.com_ajax_libs_jquery_3.5.1_jquery.js" charset="utf-8"></script>
<script>
    layui.use(['form', 'layer', 'table', 'laydate'], function() {
        var form = layui.form;
        var layer = layui.layer;
        var laydate = layui.laydate;
        laydate.render({
            elem: '#storageDate',

        });
        form.on('submit(formSubmit)', function(data) {
            let formData = data.field;
            if (parseFloat(formData.unitPrice) <= 0 || parseInt(formData.quantity) <= 0) {
                layer.msg('请输入正确的单价与数量');
                return false;
            }
            let unitPrice = parseFloat(formData.unitPrice);
            let quantity = parseInt(formData.quantity);
            formData.price = unitPrice * quantity;
            var loadingIndex = layer.load(1);
            fetch('/api/onceFill/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
                .then(response => response.json())
                .then(data => {
                    // Close loading animation
                    layer.close(loadingIndex);

                    if (data.status === "success") {
                        layer.msg('添加成功！');
                        $('#onceFillForm')[0].reset();  // 清除表单内容
                    } else {
                        layer.msg('Error: ' + data.message);
                    }
                })
                .catch(error => {
                    // Close loading animation
                    layer.close(loadingIndex);
                    layer.msg('Error: ' + error.message);
                });
            return false;
        });
    });
</script>
</body>
</html>
